#! /bin/bash
# AtCoder frontend utility for (formaly) Make
#set -x

CMD="$1"

case ${CMD} in
-h|--help)
  cat<<'EOF'
Usage: am <command> <params>

command:
  new <contest_id>   create task directory
  t <extension>      test code by oj
  tf <extension>     test code by oj (with float tolerance)
  test <extension>   execute code and display results
  s <extension>      submit code by oj
  dl                 download test cases
  o                  open task web page by browser
EOF
  ;;
new|setup)
  CONTEST="$2"
  (cd ${CONTEST_DIR}; acc new ${CONTEST} --no-tests)
  ;;
*)
  EXT="$2"

  case ${EXT} in
  \.java)
    PROG=java
    ;;
  \.py)
    PROG=python
    ;;
  \.cpp|\.c++)
    PROG=c++
    ;;
  \.rb)
    PROG=ruby
    ;;
  \.erl)
    PROG=erlang
    ;;
  \.ex)
    PROG=elixir
    ;;
  \.js)
    PROG=javascript
    ;;
  \.php)
    PROG=php
    ;;
  \.rs)
    PROG=rust
    ;;
  *)
    PROG=UNKNOWN
    ;;
  esac

  export PROG
  make ${CMD}
  ;;
esac
